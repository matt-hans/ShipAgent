---
phase: 05-orchestration-agent
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/orchestrator/agent/__init__.py
  - src/orchestrator/agent/config.py
autonomous: true

must_haves:
  truths:
    - "Agent configuration defines MCP server spawn commands"
    - "Data MCP configured with Python interpreter and module path"
    - "UPS MCP configured with Node.js and dist path"
    - "Environment variables properly passed to child processes"
  artifacts:
    - path: "src/orchestrator/agent/config.py"
      provides: "MCP server configurations for ClaudeAgentOptions"
      exports: ["create_agent_options", "MCPServerConfig", "PROJECT_ROOT"]
    - path: "src/orchestrator/agent/__init__.py"
      provides: "Agent package exports"
      contains: "from src.orchestrator.agent.config import"
  key_links:
    - from: "src/orchestrator/agent/config.py"
      to: "src/mcp/data_source/server.py"
      via: "module path in command args"
      pattern: "src\\.mcp\\.data_source\\.server"
    - from: "src/orchestrator/agent/config.py"
      to: "packages/ups-mcp/dist/index.js"
      via: "node path in command args"
      pattern: "ups-mcp/dist/index\\.js"
---

<objective>
Create the foundation configuration for the Orchestration Agent that defines how MCP servers are spawned as child processes.

Purpose: Establish the core configuration structure that ClaudeAgentOptions uses to spawn and manage Data MCP and UPS MCP as stdio child processes.

Output: Agent configuration module with MCP server definitions ready for ClaudeSDKClient integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-orchestration-agent/05-RESEARCH.md

# Existing MCP servers to integrate
@src/mcp/data_source/server.py
@packages/ups-mcp/src/index.ts
@packages/ups-mcp/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Agent Package Structure</name>
  <files>src/orchestrator/agent/__init__.py</files>
  <action>
Create the agent subpackage under src/orchestrator/agent/.

The __init__.py should:
1. Be a placeholder that will export from config.py (added in Task 2)
2. Include module docstring explaining this is the orchestration agent package
3. Leave exports empty for now (populated after config.py created)

Keep minimal - just establish the package structure.
  </action>
  <verify>
```bash
python -c "from src.orchestrator import agent; print('Agent package importable')"
```
  </verify>
  <done>Agent package exists and is importable from src.orchestrator</done>
</task>

<task type="auto">
  <name>Task 2: Create MCP Server Configuration</name>
  <files>src/orchestrator/agent/config.py</files>
  <action>
Create config.py with:

1. **PROJECT_ROOT constant**: Path to project root (parent of src/)

2. **MCPServerConfig TypedDict**: Structure for MCP server definitions
   ```python
   class MCPServerConfig(TypedDict):
       command: str  # "python" or "node"
       args: list[str]  # Command arguments
       env: dict[str, str]  # Environment variables
   ```

3. **get_data_mcp_config() function**: Returns config for Data Source MCP
   - command: "python"
   - args: ["-m", "src.mcp.data_source.server"]
   - env: {"PYTHONPATH": str(PROJECT_ROOT)}

4. **get_ups_mcp_config() function**: Returns config for UPS MCP
   - command: "node"
   - args: [str(PROJECT_ROOT / "packages/ups-mcp/dist/index.js")]
   - env: Pass through UPS credentials from os.environ:
     - UPS_CLIENT_ID
     - UPS_CLIENT_SECRET
     - UPS_ACCOUNT_NUMBER
     - UPS_LABELS_OUTPUT_DIR (default to PROJECT_ROOT / "labels")

5. **create_mcp_servers_config() function**: Returns dict for ClaudeAgentOptions.mcp_servers
   ```python
   def create_mcp_servers_config() -> dict[str, MCPServerConfig]:
       return {
           "data": get_data_mcp_config(),
           "ups": get_ups_mcp_config(),
       }
   ```

Per RESEARCH.md patterns:
- Use pathlib.Path for all paths
- Get environment variables with os.environ.get() with sensible defaults for optional vars
- Log warning to stderr if required UPS credentials missing (but don't fail - let MCP fail with clear error)

DO NOT:
- Import from claude_agent_sdk yet (that's Plan 02)
- Create the full ClaudeAgentOptions (that's Plan 04)
  </action>
  <verify>
```bash
python -c "
from src.orchestrator.agent.config import (
    PROJECT_ROOT,
    MCPServerConfig,
    get_data_mcp_config,
    get_ups_mcp_config,
    create_mcp_servers_config,
)
config = create_mcp_servers_config()
assert 'data' in config
assert 'ups' in config
assert config['data']['command'] == 'python'
assert config['ups']['command'] == 'node'
print('Config validated')
"
```
  </verify>
  <done>MCP server configurations defined and validated, ready for ClaudeAgentOptions</done>
</task>

<task type="auto">
  <name>Task 3: Update Package Exports</name>
  <files>src/orchestrator/agent/__init__.py</files>
  <action>
Update src/orchestrator/agent/__init__.py to export from config.py:

```python
from src.orchestrator.agent.config import (
    PROJECT_ROOT,
    MCPServerConfig,
    get_data_mcp_config,
    get_ups_mcp_config,
    create_mcp_servers_config,
)

__all__ = [
    "PROJECT_ROOT",
    "MCPServerConfig",
    "get_data_mcp_config",
    "get_ups_mcp_config",
    "create_mcp_servers_config",
]
```

Add module docstring explaining:
- This package contains the Orchestration Agent
- Uses Claude Agent SDK to coordinate MCPs
- MCPs spawned as child processes via stdio
  </action>
  <verify>
```bash
python -c "
from src.orchestrator.agent import create_mcp_servers_config
config = create_mcp_servers_config()
print(f'Data MCP command: {config[\"data\"][\"command\"]}')
print(f'UPS MCP command: {config[\"ups\"][\"command\"]}')
"
```
  </verify>
  <done>Agent package exports configuration functions for use by other modules</done>
</task>

</tasks>

<verification>
1. Agent package importable: `python -c "from src.orchestrator.agent import create_mcp_servers_config"`
2. Data MCP config points to correct module
3. UPS MCP config points to correct dist path
4. Environment variables properly configured
</verification>

<success_criteria>
1. `src/orchestrator/agent/` package exists and is importable
2. `create_mcp_servers_config()` returns valid configuration for both MCPs
3. Paths resolve correctly relative to PROJECT_ROOT
4. UPS environment variables passed through (with warnings if missing)
</success_criteria>

<output>
After completion, create `.planning/phases/05-orchestration-agent/05-01-SUMMARY.md`
</output>
