---
phase: 03-ups-integration-mcp
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/ups-mcp/package.json
  - packages/ups-mcp/tsconfig.json
  - packages/ups-mcp/src/index.ts
  - packages/ups-mcp/src/config.ts
  - packages/ups-mcp/src/generated/shipping.ts
  - packages/ups-mcp/src/generated/rating.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "TypeScript MCP server starts without error when credentials are present"
    - "Server fails fast with clear message when credentials are missing"
    - "Zod schemas exist for UPS Shipping and Rating API types"
  artifacts:
    - path: "packages/ups-mcp/package.json"
      provides: "Package configuration with MCP SDK and Zod dependencies"
      contains: "@modelcontextprotocol/sdk"
    - path: "packages/ups-mcp/tsconfig.json"
      provides: "TypeScript configuration for ES modules"
      contains: "ESNext"
    - path: "packages/ups-mcp/src/index.ts"
      provides: "MCP server entry point with stdio transport"
      exports: ["default"]
    - path: "packages/ups-mcp/src/config.ts"
      provides: "Environment validation and configuration"
      exports: ["config", "validateConfig"]
    - path: "packages/ups-mcp/src/generated/shipping.ts"
      provides: "Zod schemas from shipping.yaml"
      contains: "z.object"
    - path: "packages/ups-mcp/src/generated/rating.ts"
      provides: "Zod schemas from rating.yaml"
      contains: "z.object"
  key_links:
    - from: "packages/ups-mcp/src/index.ts"
      to: "packages/ups-mcp/src/config.ts"
      via: "import config"
      pattern: "import.*config"
---

<objective>
Create TypeScript MCP package foundation with Zod schema generation from UPS OpenAPI specs.

Purpose: Establish the base infrastructure that all UPS MCP tools will build upon, including project setup, configuration management, and type-safe schemas generated from official UPS API specifications.

Output: Working MCP server skeleton that validates credentials on startup and has generated Zod schemas ready for use.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ups-integration-mcp/03-RESEARCH.md
@docs/shipping.yaml
@docs/rating.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TypeScript package structure</name>
  <files>
    packages/ups-mcp/package.json
    packages/ups-mcp/tsconfig.json
    packages/ups-mcp/.gitignore
  </files>
  <action>
    Create the packages/ups-mcp directory and initialize TypeScript project:

    1. Create package.json with:
       - name: "@shipagent/ups-mcp"
       - type: "module" (ESM)
       - main: "dist/index.js"
       - scripts: build (tsc), start (node dist/index.js), generate:schemas
       - dependencies:
         - @modelcontextprotocol/sdk: "^1.0.0"
         - zod: "^3.23.0"
       - devDependencies:
         - typescript: "^5.4.0"
         - @types/node: "^20.0.0"
         - openapi-zod-client: "^1.18.0"
         - vitest: "^2.0.0"

    2. Create tsconfig.json with:
       - target: "ES2022"
       - module: "NodeNext"
       - moduleResolution: "NodeNext"
       - strict: true
       - outDir: "dist"
       - rootDir: "src"
       - esModuleInterop: true
       - skipLibCheck: true
       - declaration: true

    3. Create .gitignore with node_modules, dist, *.log, .env

    4. Run: cd packages/ups-mcp && pnpm install
  </action>
  <verify>
    cd packages/ups-mcp && pnpm run build (should succeed with no source files yet)
    ls packages/ups-mcp/node_modules/@modelcontextprotocol (dependency installed)
  </verify>
  <done>
    Package structure exists with all dependencies installed, TypeScript configured for ESM
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate Zod schemas from OpenAPI specs</name>
  <files>
    packages/ups-mcp/src/generated/shipping.ts
    packages/ups-mcp/src/generated/rating.ts
  </files>
  <action>
    Generate Zod schemas from UPS OpenAPI specifications:

    1. Create src/generated/ directory

    2. Run openapi-zod-client for shipping API:
       pnpx openapi-zod-client ../../docs/shipping.yaml -o src/generated/shipping.ts --export-schemas

    3. Run openapi-zod-client for rating API:
       pnpx openapi-zod-client ../../docs/rating.yaml -o src/generated/rating.ts --export-schemas

    4. Add npm script to package.json:
       "generate:schemas": "openapi-zod-client ../../docs/shipping.yaml -o src/generated/shipping.ts --export-schemas && openapi-zod-client ../../docs/rating.yaml -o src/generated/rating.ts --export-schemas"

    5. Verify generated files export schemas:
       - ShipmentRequestSchema
       - ShipmentResponseSchema
       - RateRequestSchema
       - RateResponseSchema

    If openapi-zod-client produces unusable output (common with complex specs), create minimal manual schemas for the types we actually need:
    - ShipmentRequest, ShipmentResponse for shipping
    - RateRequest, RateResponse for rating
    - AddressValidationRequest, AddressValidationResponse

    Manual schemas should match UPS API structure documented in the OpenAPI specs.
  </action>
  <verify>
    grep -l "z.object" packages/ups-mcp/src/generated/shipping.ts
    grep -l "z.object" packages/ups-mcp/src/generated/rating.ts
    cd packages/ups-mcp && pnpm run build (compiles without type errors)
  </verify>
  <done>
    Zod schemas generated and compilable, ready for import in tool handlers
  </done>
</task>

<task type="auto">
  <name>Task 3: Create config and MCP server skeleton</name>
  <files>
    packages/ups-mcp/src/config.ts
    packages/ups-mcp/src/index.ts
  </files>
  <action>
    Create configuration management and MCP server entry point:

    1. Create src/config.ts:
       - Define Config interface with:
         - clientId: string (from UPS_CLIENT_ID)
         - clientSecret: string (from UPS_CLIENT_SECRET)
         - accountNumber: string (from UPS_ACCOUNT_NUMBER)
         - labelsOutputDir: string (from LABELS_OUTPUT_DIR, default: "./labels")
         - baseUrl: string (hardcode sandbox: "https://wwwcie.ups.com/api")
       - Export validateConfig() function that:
         - Checks all required env vars exist
         - Throws Error listing missing vars if any are absent
         - Returns Config object if all present
       - Export config singleton (call validateConfig() on load)

    2. Create src/index.ts:
       - Import McpServer from @modelcontextprotocol/sdk/server/mcp.js
       - Import StdioServerTransport from @modelcontextprotocol/sdk/server/stdio.js
       - Import config (this triggers validation)
       - Create McpServer instance with name "ups-mcp", version "1.0.0"
       - Create StdioServerTransport
       - Call server.connect(transport)
       - Add console.error startup message (stderr, not stdout - stdout is for MCP protocol)

    Server should start successfully when credentials are set, fail immediately when missing.

    Per CONTEXT.md Decision 1:
    - Fail fast on missing credentials
    - Single account only
    - Sandbox environment only (no production URLs)
  </action>
  <verify>
    cd packages/ups-mcp && pnpm run build (compiles successfully)

    # Test missing credentials (should fail):
    cd packages/ups-mcp && node dist/index.js 2>&1 | grep -i "missing"

    # Test with credentials (should start):
    UPS_CLIENT_ID=test UPS_CLIENT_SECRET=test UPS_ACCOUNT_NUMBER=test timeout 2 node dist/index.js 2>&1 || true
  </verify>
  <done>
    MCP server starts with credentials, fails fast without credentials, uses stdio transport
  </done>
</task>

</tasks>

<verification>
All verification commands should pass:

```bash
# Package structure exists
test -f packages/ups-mcp/package.json && echo "OK: package.json exists"
test -f packages/ups-mcp/tsconfig.json && echo "OK: tsconfig.json exists"

# Dependencies installed
test -d packages/ups-mcp/node_modules/@modelcontextprotocol && echo "OK: MCP SDK installed"
test -d packages/ups-mcp/node_modules/zod && echo "OK: Zod installed"

# Schemas generated
test -f packages/ups-mcp/src/generated/shipping.ts && echo "OK: shipping schemas exist"
test -f packages/ups-mcp/src/generated/rating.ts && echo "OK: rating schemas exist"

# TypeScript compiles
cd packages/ups-mcp && pnpm run build && echo "OK: TypeScript compiles"

# Config validates credentials
cd packages/ups-mcp && node dist/index.js 2>&1 | grep -qi "missing\|required\|UPS_" && echo "OK: fails on missing credentials"
```
</verification>

<success_criteria>
- TypeScript MCP package compiles without errors
- MCP SDK and Zod dependencies installed
- Zod schemas generated from both shipping.yaml and rating.yaml
- Server fails fast with clear error when UPS_CLIENT_ID, UPS_CLIENT_SECRET, or UPS_ACCOUNT_NUMBER missing
- Server starts successfully when all credentials provided
- Stdio transport configured for Claude SDK integration
</success_criteria>

<output>
After completion, create `.planning/phases/03-ups-integration-mcp/03-01-SUMMARY.md`
</output>
