---
phase: 07-web-interface
plan: 04
type: execute
wave: 2
depends_on: ["07-01", "07-02"]
files_modified:
  - frontend/src/components/ProgressDisplay.tsx
  - frontend/src/components/RowStatusTable.tsx
  - frontend/src/components/ErrorAlert.tsx
  - frontend/src/pages/Dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "User sees progress bar showing current row / total rows during execution"
    - "Progress updates in real-time via SSE"
    - "User can expand to see per-row status table"
    - "Error alert appears when batch fails with expandable details"
  artifacts:
    - path: "frontend/src/components/ProgressDisplay.tsx"
      provides: "Progress bar with row counter"
      min_lines: 40
    - path: "frontend/src/components/RowStatusTable.tsx"
      provides: "Expandable table of row statuses"
      min_lines: 50
    - path: "frontend/src/components/ErrorAlert.tsx"
      provides: "Error banner with expandable details"
      min_lines: 30
  key_links:
    - from: "frontend/src/components/ProgressDisplay.tsx"
      to: "frontend/src/hooks/useJobProgress.ts"
      via: "hook usage"
      pattern: "useJobProgress"
    - from: "frontend/src/pages/Dashboard.tsx"
      to: "frontend/src/components/ProgressDisplay.tsx"
      via: "component import"
      pattern: "import.*ProgressDisplay"
---

<critical_instruction>
## MANDATORY: Use Frontend Design Skill

**Before implementing ANY UI components, visual elements, or user-facing code, you MUST invoke the `@frontend-design` skill using the Skill tool.**

This applies to:
- All React components
- All CSS/styling decisions
- Layout and spacing
- Color choices and visual hierarchy
- Interactive states (hover, focus, loading, error)
- Typography and iconography

**How to invoke:** Use the Skill tool with `skill: "frontend-design"` before writing any frontend code.

This is NON-NEGOTIABLE. The goal is a distinctive, high-quality UI that avoids generic AI aesthetics.
</critical_instruction>

<objective>
Build real-time progress display with SSE-driven updates during batch execution.

Purpose: Provides users with live feedback on batch processing status, individual row progress, and error visibility.
Output: Progress components integrated into Dashboard that show real-time batch execution status.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-web-interface/07-CONTEXT.md
@.planning/phases/07-web-interface/07-RESEARCH.md
@.planning/phases/07-web-interface/07-01-SUMMARY.md
@.planning/phases/07-web-interface/07-02-SUMMARY.md
@frontend/src/hooks/useJobProgress.ts
@frontend/src/hooks/useSSE.ts
</context>

<design_note>
When implementing React components, leverage @frontend-design skill for high-quality UI design.
Per CONTEXT.md Decision 2: Progress bar with counter, expandable table, inline error alerts.
</design_note>

<tasks>

<task type="auto">
  <name>Task 1: Create progress display component</name>
  <files>
    frontend/src/components/ProgressDisplay.tsx
  </files>
  <action>
    1. Create ProgressDisplay.tsx:
       - Props: jobId: string
       - Uses useJobProgress(jobId) hook internally
       - Displays:
         - Progress bar (shadcn/ui Progress component)
         - Text counter: "Processing X of Y shipments"
         - Percentage complete
         - Estimated time remaining (optional, based on average row time)
       - States:
         - Connecting: "Connecting to progress stream..."
         - Running: Progress bar animating
         - Completed: "Batch complete! X shipments processed"
         - Failed: Triggers error display

    2. Styling:
       - Centered progress section
       - Large, readable counter text
       - Smooth progress bar animation
       - Green completion state, red failure state
  </action>
  <verify>
    cd /Users/matthewhans/Desktop/Programming/ShipAgent/frontend && npm run build
  </verify>
  <done>
    ProgressDisplay shows live progress bar and counter from SSE events
  </done>
</task>

<task type="auto">
  <name>Task 2: Create row status table and error alert components</name>
  <files>
    frontend/src/components/RowStatusTable.tsx
    frontend/src/components/ErrorAlert.tsx
  </files>
  <action>
    1. Create RowStatusTable.tsx:
       - Props: jobId: string, isExpanded: boolean, onToggle()
       - Fetches rows from GET /api/v1/jobs/{jobId}/rows
       - Displays collapsible table with columns:
         - Row number
         - Status badge (pending, processing, completed, failed)
         - Tracking number (if completed)
         - Cost (if completed)
         - Error message (if failed)
       - Collapsed by default (per CONTEXT.md Decision 2)
       - Toggle button: "Show details" / "Hide details"
       - Use shadcn/ui ScrollArea for scrollable content
       - Auto-refresh during execution phase

    2. Create ErrorAlert.tsx:
       - Props: errorCode: string, errorMessage: string, rowNumber?: number, onDismiss()
       - Displays as inline alert banner (per CONTEXT.md Decision 2)
       - Shows:
         - Error icon
         - Error code and message summary
         - Expandable section with full details
         - Which row failed (if applicable)
       - Use shadcn/ui Alert component
       - Dismiss button
  </action>
  <verify>
    cd /Users/matthewhans/Desktop/Programming/ShipAgent/frontend && npm run build
  </verify>
  <done>
    RowStatusTable shows per-row status; ErrorAlert displays failure details
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate progress components into Dashboard</name>
  <files>
    frontend/src/pages/Dashboard.tsx
    frontend/src/lib/api.ts
  </files>
  <action>
    1. Update Dashboard.tsx to add 'executing' phase:
       - When confirmation succeeds, transition to 'executing' phase
       - Render ProgressDisplay with current jobId
       - Show RowStatusTable (collapsed by default)
       - On batch_completed event, transition to 'complete' phase
       - On batch_failed event, show ErrorAlert and keep progress visible

    2. Add 'complete' phase to Dashboard:
       - Show completion summary
       - Display final row count and total cost
       - Link to download labels (prepared for Plan 05)
       - "Start New Batch" button to return to 'input' phase

    3. Update lib/api.ts:
       - Add getJobRows(jobId: string): Promise<JobRow[]> if not already present
       - This is used by RowStatusTable for row details

    4. Handle SSE connection lifecycle:
       - Connect when entering 'executing' phase
       - Disconnect when leaving 'executing' phase
       - Handle reconnection if connection drops
  </action>
  <verify>
    cd /Users/matthewhans/Desktop/Programming/ShipAgent/frontend && npm run build
  </verify>
  <done>
    Dashboard shows real-time progress during execution with row details and error handling
  </done>
</task>

</tasks>

<verification>
1. Run: cd frontend && npm run build (builds without errors)
2. Run: cd frontend && npx tsc --noEmit (no TypeScript errors)
3. Manual: Start both servers, submit command, confirm, watch progress bar update
4. Manual: Expand row details table during execution
5. Manual: Simulate error to verify ErrorAlert displays correctly
</verification>

<success_criteria>
- [ ] ProgressDisplay shows progress bar and "X of Y" counter
- [ ] Progress updates live via SSE without page refresh
- [ ] RowStatusTable displays per-row status when expanded
- [ ] ErrorAlert shows when batch fails with error details
- [ ] Dashboard transitions through input -> preview -> executing -> complete phases
- [ ] SSE connection managed properly (connect on execute, disconnect on complete)
- [ ] Completion state shows final summary with total cost
</success_criteria>

<output>
After completion, create `.planning/phases/07-web-interface/07-04-SUMMARY.md`
</output>
